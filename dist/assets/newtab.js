import{j as o,r as u,a as S,b as y,n as x,p as j,c as v,C as w,s as C,d as N,e as D,f as L,g as A,h as P}from"./pomodoroLogic-BSaq9K96.js";const T=({open:t,durations:e,setDurations:i,onClose:a,name:m="",setName:p})=>t?o.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.5)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},onClick:a,children:o.jsxs("div",{style:{background:"#222",padding:"2em",borderRadius:16,minWidth:320,boxShadow:"0 4px 32px #000a",position:"relative"},onClick:s=>s.stopPropagation(),children:[o.jsx("h2",{style:{marginTop:0,textAlign:"center"},children:"Pomodoro Settings"}),o.jsxs("form",{onSubmit:s=>{s.preventDefault(),a(),chrome.storage.local.set({pomodoroDurations:e,userName:m})},style:{display:"flex",flexDirection:"column",gap:"1em"},children:[p&&o.jsxs("label",{children:["Name:",o.jsx("input",{type:"text",value:m,onChange:s=>p(s.target.value),placeholder:"Your name",style:{marginLeft:8}})]}),o.jsxs("label",{children:["Focus (minutes):",o.jsx("input",{type:"number",min:1,max:120,value:e.focus,onChange:s=>i({...e,focus:Number(s.target.value)}),style:{marginLeft:8,width:60}})]}),o.jsxs("label",{children:["Break (minutes):",o.jsx("input",{type:"number",min:1,max:60,value:e.break,onChange:s=>i({...e,break:Number(s.target.value)}),style:{marginLeft:8,width:60}})]}),o.jsxs("label",{children:["Long Break (minutes):",o.jsx("input",{type:"number",min:1,max:60,value:e.long,onChange:s=>i({...e,long:Number(s.target.value)}),style:{marginLeft:8,width:60}})]}),o.jsx("button",{type:"submit",style:{marginTop:"1em",padding:"0.5em 2em",borderRadius:8,border:"none",background:"#2563eb",color:"#fff",fontWeight:600,fontSize:"1.1em",cursor:"pointer"},children:"Save"})]}),o.jsx("button",{onClick:a,style:{position:"absolute",top:8,right:12,background:"none",border:"none",color:"#fff",fontSize:"1.5em",cursor:"pointer"},title:"Close",children:"×"})]})}):null,E=({percent:t,time:e,label:i})=>o.jsxs("div",{className:"pomodoro-circle",children:[o.jsxs("svg",{children:[o.jsx("circle",{cx:"50%",cy:"50%",r:"48%",stroke:"#fff4",strokeWidth:"6%",fill:"none"}),o.jsx("circle",{cx:"50%",cy:"50%",r:"48%",stroke:"#fff",strokeWidth:"6%",fill:"none",strokeDasharray:Math.PI*2*48,strokeDashoffset:Math.PI*2*48*(1-t),style:{transition:"stroke-dashoffset 0.5s"}})]}),o.jsxs("div",{className:"pomodoro-circle-time",children:[e,o.jsx("div",{style:{fontSize:"1vw",fontWeight:400,opacity:.7},children:i})]})]}),B={phase:"idle",endsAt:null,running:!1,cycle:0},F=({durations:t})=>{const[e,i]=u.useState(B);u.useEffect(()=>{S(n=>i(n));const d=n=>{n.pomodoroState&&n.pomodoroState.newValue&&i(n.pomodoroState.newValue)};return chrome.storage.onChanged.addListener(d),()=>chrome.storage.onChanged.removeListener(d)},[]),u.useEffect(()=>{if(!e.running||!e.endsAt)return;const d=setInterval(()=>{const n=y(e,x(t));n?a(n):i(k=>({...k}))},1e3);return()=>clearInterval(d)},[e,t]);const a=d=>{i(d),j(d)},m=()=>a(C(e,x(t))),p=()=>a(N({...e,phase:"focus"},x(t))),s=()=>a(L(e)),c=()=>a(A(e)),g=()=>a(D()),r=e.running&&e.endsAt?Math.max(0,Math.floor((e.endsAt-Date.now())/1e3)):e.pausedAt?Math.floor(e.pausedAt/1e3):e.phase==="focus"?t.focus*60:e.phase==="break"?t.break*60:t.long*60,l=e.phase==="focus"?r/(t.focus*60):e.phase==="break"?r/(t.break*60):e.phase==="long-break"?r/(t.long*60):0,h=`${String(Math.floor(r/60)).padStart(2,"0")}:${String(r%60).padStart(2,"0")}`,b=v(e);return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"pomodoro-tabs",children:[o.jsx("div",{className:"pomodoro-tab"+(e.phase==="focus"?" active":""),onClick:()=>{e.phase!=="focus"&&m()},children:"FOCUS"}),o.jsx("div",{className:"pomodoro-tab"+(e.phase==="break"?" active":""),onClick:()=>{e.phase!=="break"&&p()},children:"BREAK"})]}),o.jsx(E,{percent:l,time:h,label:e.phase==="focus"?"Focus":e.phase==="break"?"Break":"Long Break"}),o.jsxs("div",{style:{display:"flex",gap:"1em",justifyContent:"center"},children:[o.jsx("button",{className:"newtab-focus-btn",style:{background:"#b91c1c",marginTop:"1em"},onClick:g,children:"Stop"}),e.running&&o.jsx("button",{className:"newtab-focus-btn",style:{background:"#f59e42",marginTop:"1em"},onClick:s,children:"Pause"}),!e.running&&e.pausedAt&&o.jsx("button",{className:"newtab-focus-btn",style:{background:"#2563eb",marginTop:"1em"},onClick:c,children:"Resume"})]}),o.jsxs("div",{style:{marginTop:"1em",fontSize:"1.2vw",opacity:.7},children:["Cycle: ",b,"/",w," ",e.phase==="long-break"&&"(Long Break)"]})]})},I=({durations:t,time:e,name:i,mainTask:a,editTask:m,setMainTask:p,setEditTask:s})=>{const[c,g]=u.useState(null);return u.useEffect(()=>{chrome.storage.local.get(["pomodoroState"],l=>{l.pomodoroState&&g(l.pomodoroState)});const r=l=>{l.pomodoroState&&l.pomodoroState.newValue&&g(l.pomodoroState.newValue)};return chrome.storage.onChanged.addListener(r),()=>chrome.storage.onChanged.removeListener(r)},[]),c&&(c.running||!c.running&&c.pausedAt!=null&&c.phase!=="idle")?o.jsx(F,{durations:t}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"newtab-time",children:[e.getHours().toString().padStart(2,"0"),":",e.getMinutes().toString().padStart(2,"0")]}),o.jsx("div",{className:"newtab-greeting",children:R(i||"")}),o.jsx("div",{className:"newtab-task-label",children:"What is your main focus for today?"}),m?o.jsx("input",{className:"newtab-task-input",value:a,autoFocus:!0,onChange:r=>p(r.target.value),onBlur:()=>{s(!1),chrome.storage.local.set({mainTask:{text:a,done:!1}})},onKeyDown:r=>{r.key==="Enter"&&(s(!1),chrome.storage.local.set({mainTask:{text:a,done:!1}}))}}):o.jsx("input",{className:"newtab-task-input",value:a,readOnly:!0,onClick:()=>s(!0)}),o.jsx("button",{className:"newtab-focus-btn",onClick:()=>{const l={phase:"focus",running:!0,endsAt:Date.now()+t.focus*60*1e3,cycle:c&&typeof c.cycle=="number"?c.cycle:0};chrome.storage.local.set({pomodoroState:l})},children:"Start Focus"})]})};function R(t){const e=new Date().getHours();return e<12?`Good morning, ${t}.`:e<18?`Good afternoon, ${t}.`:`Good evening, ${t}.`}const f={focus:25,break:5,long:15},M=()=>{const[t,e]=u.useState(""),[i,a]=u.useState(""),[m,p]=u.useState(!1),[s,c]=u.useState(new Date),[g,r]=u.useState(!1),[l,h]=u.useState(f);return u.useEffect(()=>{const b=setInterval(()=>c(new Date),1e3);chrome.storage.local.get(["userName","mainTask","pomodoroDurations"],n=>{n.userName&&e(n.userName),n.mainTask&&a(n.mainTask.text||""),n.pomodoroDurations&&h({focus:Number(n.pomodoroDurations.focus)||f.focus,break:Number(n.pomodoroDurations.break)||f.break,long:Number(n.pomodoroDurations.long)||f.long})});const d=n=>{n.pomodoroDurations&&n.pomodoroDurations.newValue&&h({focus:Number(n.pomodoroDurations.newValue.focus)||f.focus,break:Number(n.pomodoroDurations.newValue.break)||f.break,long:Number(n.pomodoroDurations.newValue.long)||f.long})};return chrome.storage.onChanged.addListener(d),()=>{clearInterval(b),chrome.storage.onChanged.removeListener(d)}},[]),o.jsxs("div",{className:"newtab-center",children:[o.jsx("button",{style:{position:"absolute",top:24,left:24,zIndex:10,background:"#ccc",border:"none",borderRadius:40,width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"1.5em",color:"#fff"},onClick:()=>r(!0),title:"Settings",children:o.jsx("span",{role:"img","aria-label":"settings",children:"⚙️"})}),o.jsx(T,{open:g,durations:l,setDurations:h,onClose:()=>r(!1),name:t,setName:e}),o.jsx(I,{durations:l,time:s,name:t,mainTask:i,editTask:m,setMainTask:a,setEditTask:p})]})};P(document.getElementById("root")).render(o.jsx(M,{}));
